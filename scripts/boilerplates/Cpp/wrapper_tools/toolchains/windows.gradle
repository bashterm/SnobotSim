

model {

    toolChains 
    {
        visualCpp(VisualCpp) 
        {
            // Workaround for VS2015 adapted from https://github.com/couchbase/couchbase-lite-java-native/issues/23
            def VS_2015_INCLUDE_DIR = "C:/Program Files (x86)/Windows Kits/10/Include/10.0.10240.0/ucrt"
            def VS_2015_LIB_DIR = "C:/Program Files (x86)/Windows Kits/10/Lib/10.0.10240.0/ucrt"
            
            def jni_include_path = System.properties.'java.home' + "/../include"
            def jni_dir = new File("${jni_include_path}")
            if(!jni_dir.exists())
            {
                throw new GradleException("Could not find JNI include path ${jni_dir}.  Make sure JAVA_HOME is defined and points to a JDK, and not a JRE")
            }

            eachPlatform {
                cppCompiler.withArguments { args ->
                    args << '/EHsc' << '/DNOMINMAX' << '/D_SCL_SECURE_NO_WARNINGS' << '/D_WINSOCK_DEPRECATED_NO_WARNINGS'
                    if (file(VS_2015_INCLUDE_DIR).exists()) {
                        args << "/I$VS_2015_INCLUDE_DIR"
                        args << "/I$jni_include_path"
                        args << "/I$jni_include_path/win32"
                    }
                }
                linker.withArguments { args ->
                    if (file(VS_2015_LIB_DIR).exists()) {
                        if (platform.architecture.name == 'x86') {
                            args << "/LIBPATH:$VS_2015_LIB_DIR/x86"
                        } else {
                            args << "/LIBPATH:$VS_2015_LIB_DIR/x64"
                        }
                    }
                }
            }
        }
    }
}

def defineExternalLibraries() {
    ext.wpilibcLibraryPath       = wpilibBuildPath     + '/native/shared/x64/wpilibc.lib'
    ext.networkTablesLibraryPath = wpilibBuildPath     + '/native/shared/x64/ntcore.lib'
    ext.wpilibLibraryPath        = wpilibBuildPath     + '/native/shared/x64/wpiutil.lib'
    ext.halLibraryPath           = snobotSimNativeLibs + '/native/shared/x64/HALAthena.lib'
    ext.canTalonLibraryPath      = snobotSimNativeLibs + '/native/shared/x64/ctrCpp.lib'
}

ext
{
    defineExternalLibraries = this.&defineExternalLibraries

}


