import org.gradle.internal.os.OperatingSystem

apply plugin: 'maven-publish'


task combineLibrariesIntoOne(type: Jar) {

    def os_name = org.gradle.internal.os.OperatingSystem.current().getFamilyName();

    classifier = "uber_native-" + os_name;
    
    if(new File('ctre_override/build/libs/ctre_override.jar').exists()) 
    {
        from(zipTree('ctre_override/build/libs/ctre_override.jar')) 
        from(zipTree('ctre_override/build/ctre_override-native-' + os_name + ".jar"))
    }
    from(zipTree('hal_override/build/halAthena-native-' + os_name + ".jar"))
    from(zipTree('snobot_sim/build/snobotSim-native-' + os_name + ".jar"))
    from(zipTree('snobot_sim_gui/build/snobot_sim_gui-native-' + os_name + ".jar"))
    
    def wpiutil_path = "build/dependencies/wpiutil-cpp/" + os_name + "x86-64/" + os_name + "/x86-64/shared"

    from(wpiutil_path) {
        into os_name + "/x86-64/"
        include "*.dll"
        include "*.so"
    }
}


publishing {

    repositories {
       maven {
           url maven_publishing_path
       }
    }
    

    publications {
        snobotSimLibs(MavenPublication) {
            artifact combineLibrariesIntoOne
        
            groupId 'com.snobot.simulator'
            artifactId 'snobot_sim_native'
            version maven_version
        }
    }
}
